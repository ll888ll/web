{% extends "accounts/base_accounts.html" %}
{% load static %}
{% load i18n %}

{% block page_title %}{% trans "Mi Inventario" %}{% endblock %}
{% block content_title %}{% trans "Mi Inventario" %}{% endblock %}

{% block content_actions %}
<a href="{% url 'accounts:shop' %}" class="btn btn--primary btn--sm">
  {% trans "Ir a la tienda" %}
</a>
{% endblock %}

{% block content %}
<div class="inventory">
  {% if items %}
  <!-- Items Grid -->
  <div class="inventory-grid">
    {% for item in items %}
    <article class="inventory-card">
      <div class="inventory-card__header">
        <h3 class="inventory-card__title">{{ item.product.name }}</h3>
        {% if item.is_gift %}
        <span class="badge badge--gift">{% trans "Regalo" %}</span>
        {% endif %}
      </div>

      <p class="inventory-card__teaser">{{ item.product.teaser }}</p>

      <div class="inventory-card__meta">
        <span class="inventory-card__date">
          {% trans "Adquirido" %}: {{ item.acquired_at|date:"d M Y" }}
        </span>
        {% if item.download_count > 0 %}
        <span class="inventory-card__downloads">
          {{ item.download_count }} {% trans "descargas" %}
        </span>
        {% endif %}
      </div>

      <div class="inventory-card__actions">
        <a href="{% url 'accounts:download' item.pk %}" class="btn btn--primary btn--sm">
          {% trans "Descargar" %}
        </a>
        <a href="{% url 'accounts:set_active' item.pk %}" class="btn btn--ghost btn--sm"
           {% if request.user.profile.active_character == item.product %}disabled{% endif %}>
          {% if request.user.profile.active_character == item.product %}
          {% trans "Activo" %}
          {% else %}
          {% trans "Usar como activo" %}
          {% endif %}
        </a>
      </div>

      {% if request.user.profile.active_character == item.product %}
      <div class="inventory-card__active-badge">
        {% trans "Personaje activo" %}
      </div>
      {% endif %}
    </article>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <nav class="pagination" aria-label="{% trans 'Paginaci\u00f3n' %}">
    <div class="pagination__info">
      {% blocktrans with current=page_obj.number total=page_obj.paginator.num_pages %}
      P\u00e1gina {{ current }} de {{ total }}
      {% endblocktrans %}
    </div>
    <div class="pagination__controls">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="pagination__btn">
        &larr; {% trans "Anterior" %}
      </a>
      {% endif %}
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="pagination__btn">
        {% trans "Siguiente" %} &rarr;
      </a>
      {% endif %}
    </div>
  </nav>
  {% endif %}

  {% else %}
  <!-- Empty State -->
  <div class="empty-state">
    <div class="empty-state__icon">&#x1F4E6;</div>
    <h3 class="empty-state__title">{% trans "Tu inventario est\u00e1 vac\u00edo" %}</h3>
    <p class="empty-state__text">
      {% trans "A\u00fan no has adquirido ning\u00fan producto. Explora nuestra tienda para encontrar algo que te guste." %}
    </p>
    <a href="{% url 'accounts:shop' %}" class="btn btn--primary">
      {% trans "Explorar tienda" %}
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}
